<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>{% block title %}ZFM Calculator{% endblock %}</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    :root { --sidebar-w: 260px; --sidebar-w-collapsed: 76px; }
    body { background:#f6f7fb; }
    .layout { display:flex; min-height:100vh; }
    .sidebar { width: var(--sidebar-w); transition: width .2s ease; background:#111827; color:#d1d5db; }
    .sidebar.collapsed { width: var(--sidebar-w-collapsed); }
    .sidebar .brand { color:#fff; font-weight:700; letter-spacing:.05em; }
    .sidebar a.nav-link { color:#cbd5e1; border-radius:.5rem; }
    .sidebar a.nav-link:hover, .sidebar a.nav-link.active { background:#1f2937; color:#fff; }
    .sidebar .nav-icon { width: 1.25rem; text-align:center; margin-right:.5rem; }
    .sidebar .nav-section { font-size:.75rem; letter-spacing:.06em; text-transform:uppercase; color:#94a3b8; margin:1rem .25rem .5rem; }
    .content { flex:1; display:flex; flex-direction:column; }
    .topbar { background:#fff; border-bottom:1px solid #e5e7eb; }
    .topbar .btn { border-radius: .5rem; }
    .page { padding: 1rem 1rem 2rem; }
    @media (max-width: 992px) {
      .sidebar { position: fixed; z-index: 1031; left:-100%; top:0; bottom:0; }
      .sidebar.show { left:0; }
    }
  </style>
  {% block head_extra %}{% endblock %}
</head>
<body>
<div class="layout">
  <!-- Sidebar -->
  <nav id="sidebar" class="sidebar d-flex flex-column p-3">
    <div class="d-flex align-items-center justify-content-between mb-3">
      <span class="brand">ZFM Calc</span>
      <button class="btn btn-sm btn-outline-light d-none d-lg-inline-flex" id="btnToggle" title="Recolher/expandir">
        <i class="bi bi-layout-sidebar-inset-reverse"></i>
      </button>
      <button class="btn btn-sm btn-outline-light d-lg-none" id="btnMobile" title="Menu">
        <i class="bi bi-list"></i>
      </button>
    </div>

    <div class="nav-section">Principal</div>
    <ul class="nav nav-pills flex-column gap-1">
              <li>
        <a class="nav-link {% if request.endpoint=='core.index' %}active{% endif %}" href="{{ url_for('core.index') }}">
          <i class="nav-icon bi bi-house"></i>
          <span class="d-none d-lg-inline">Home</span>
        </a>
      </li>
      <li>
        <a class="nav-link {% if request.endpoint=='core.dashboard' %}active{% endif %}" href="{{ url_for('core.dashboard') }}">
          <i class="nav-icon bi bi-speedometer2"></i>
          <span class="d-none d-lg-inline">Dashboard</span>
        </a>
      </li>
      <li>
        <a class="nav-link {% if request.endpoint in ['nfe.preview','nfe.calcular'] %}active{% endif %}" href="{{ url_for('core.leitorxml') }}">
          <i class="nav-icon bi bi-filetype-xml"></i>
          <span class="d-none d-lg-inline">Upload de XML's NF</span>
        </a>
      </li>
      <li>
        <a class="nav-link {% if request.endpoint=='core.support' %}active{% endif %}" href="{{ url_for('core.support') }}">
          <i class="nav-icon bi bi-life-preserver"></i>
          <span class="d-none d-lg-inline">Suporte & Base</span>
        </a>
      </li>
      <li>
        <a class="nav-link {% if request.endpoint=='auth.account' %}active{% endif %}" href="{{ url_for('auth.account') }}">
          <i class="nav-icon bi bi-person-gear"></i>
          <span class="d-none d-lg-inline">Minha conta</span>
        </a>
      </li>
    </ul>

    {% if session.get('user') and session['user'].get('is_admin') %}
      <div class="nav-section">Administração</div>
      <ul class="nav nav-pills flex-column gap-1">
        <li>
          <a class="nav-link {% if request.endpoint=='admin.index' %}active{% endif %}" href="{{ url_for('admin_bp.admin') }}">
            <i class="nav-icon bi bi-shield-lock"></i>
            <span class="d-none d-lg-inline">Admin</span>
          </a>
        </li>
        <li>
          <a class="nav-link {% if request.endpoint=='nfe.config_view' %}active{% endif %}" href="{{ url_for('nfe.config_view') }}">
            <i class="nav-icon bi bi-gear"></i>
            <span class="d-none d-lg-inline">Configurações</span>
          </a>
        </li>
        <li>
          <a class="nav-link {% if request.endpoint=='admin.payments' %}active{% endif %}" href="{{ url_for('admin_bp.admin_payments') }}">
            <i class="nav-icon bi bi-cash-coin"></i>
            <span class="d-none d-lg-inline">Pagamentos</span>
          </a>
        </li>
      </ul>
    {% endif %}

    <div class="mt-3">
      {% if session.get('user') %}
        <a class="btn btn-outline-light w-100" href="{{ url_for('auth.logout') }}">
          <i class="bi bi-box-arrow-right me-1"></i>
          Sair
        </a>
      {% else %}
        <div class="d-grid gap-2">
          <a class="btn btn-light" href="{{ url_for('auth.login') }}">
            <i class="bi bi-box-arrow-in-right me-1"></i>Login
          </a>
          <a class="btn btn-primary" href="{{ url_for('auth.register') }}">
            <i class="bi bi-person-plus me-1"></i>Criar conta
          </a>
        </div>
      {% endif %}
    </div>
  </nav>

  <!-- Conteúdo -->
  <div class="content">
    <div class="topbar d-flex align-items-center justify-content-between px-3 py-2">
      <div class="d-flex align-items-center gap-2">
        <button class="btn btn-outline-secondary d-lg-none" id="btnOpenSidebar"><i class="bi bi-list"></i></button>
        <div class="fw-semibold">{% block page_title %}{% endblock %}</div>
      </div>
      <div class="d-flex align-items-center gap-2">
        {% if session.get('user') %}
          <span class="text-muted small">Olá, {{ session['user']['name'] }}</span>
        {% endif %}
      </div>
    </div>
    <main class="page">
      {% block content %}{% endblock %}
    </main>
  </div>
</div>

<script>
  const sidebar = document.getElementById('sidebar');
  const btnToggle = document.getElementById('btnToggle');
  const btnMobile = document.getElementById('btnMobile');
  const btnOpenSidebar = document.getElementById('btnOpenSidebar');

  btnToggle?.addEventListener('click', ()=> sidebar.classList.toggle('collapsed'));
  btnMobile?.addEventListener('click', ()=> sidebar.classList.toggle('show'));
  btnOpenSidebar?.addEventListener('click', ()=> sidebar.classList.toggle('show'));
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
{% block body_extra %}{% endblock %}
</body>
</html>
