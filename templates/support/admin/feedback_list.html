{% extends "base.html" %}
{% block title %}Feedbacks — Admin{% endblock %}
{% block page_title %}<i class="bi bi-inbox me-1"></i>Feedbacks dos usuários{% endblock %}
{% block content %}
<div class="container py-3">
  <form class="d-flex gap-2 mb-3">
    <select class="form-select" name="status" style="max-width:220px">
      <option value="">Todos</option>
      <option value="novo" {{ status=='novo' and 'selected' or '' }}>Novos</option>
      <option value="lido" {{ status=='lido' and 'selected' or '' }}>Lidos</option>
      <option value="resolvido" {{ status=='resolvido' and 'selected' or '' }}>Resolvidos</option>
    </select>
    <button class="btn btn-outline-secondary"><i class="bi bi-filter"></i> Filtrar</button>
  </form>

  <div class="card shadow-sm">
    <div class="table-responsive">
      <table class="table table-sm align-middle mb-0">
        <thead class="table-light"><tr><th>#</th><th>Categoria</th><th>Assunto</th><th>Mensagem</th><th>Usuário</th><th>Status</th><th class="text-end">Ações</th></tr></thead>
        <tbody>
          {% for r in rows %}
          <tr>
            <td class="text-muted">{{ r.id }}</td>
            <td><span class="badge bg-secondary text-uppercase">{{ r.category }}</span></td>
            <td>{{ r.subject }}</td>
            <td class="text-truncate" style="max-width:420px" title="{{ r.message }}">{{ r.message }}</td>
            <td>{{ r.user_id or '—' }}</td>
            <td>
              {% if r.status=='novo' %}<span class="badge bg-primary">Novo</span>
              {% elif r.status=='lido' %}<span class="badge bg-info text-dark">Lido</span>
              {% else %}<span class="badge bg-success">Resolvido</span>{% endif %}
            </td>
            <td class="text-end">
              <form method="post" action="{{ url_for('support_admin.fb_set_status', id=r.id) }}" class="d-inline">
                <input type="hidden" name="status" value="lido">
                <button class="btn btn-outline-secondary btn-sm">Marcar lido</button>
              </form>
              <form method="post" action="{{ url_for('support_admin.fb_set_status', id=r.id) }}" class="d-inline">
                <input type="hidden" name="status" value="resolvido">
                <button class="btn btn-outline-success btn-sm">Resolver</button>
              </form>
            </td>
          </tr>
          {% else %}
          <tr><td colspan="7" class="text-muted">Sem mensagens.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
